# See http://www.appveyor.com/docs/appveyor-yml for many more options

# Skip on updates to the readme.
# We can force this by adding [skip ci] or [ci skip] anywhere in commit message
skip_commits:
  message: /Update Readme and Manifest Version/

environment:
  access_token:
    secure: EJ2HHF0klBsYS3WlZWIvcc88u5/gixju8bcOR4d13x6Fh+BA7UNU89/NPkHYP6JN


    
install:
  - choco install pester


build: false

test_script:
  # ----- This module is required for the testing
  - ps: install-module vmware.powercli
  - ps: import-module vmware.powercli

  - ps: $TestResult = Invoke-Pester -Path ".\Tests" -OutputFormat NUnitXml -OutputFile TestsResults.xml -PassThru
  - ps: (New-Object 'System.Net.WebClient').UploadFile("https://ci.appveyor.com/api/testresults/nunit/$($env:APPVEYOR_JOB_ID)", (Resolve-Path .\TestsResults.xml))
  - ps: if ($TestResult.FailedCount -gt 0) { throw "$($Test.FailedCount) tests failed."}

  
  
on_success:
  # ----- Enable Git Credential Store and add token
  - git config --global credential.helper store
  

  # ----- Update Readme.md Version number
  - ps: Add-Content "$HOME\.git-credentials" "https://$($env:access_token):x-oauth-basic@github.com`n"
  - git config --global user.email "jeffbuenting@gmail.com"
  - git config --global user.name "jeffbuenting"
  - ps: $Readme = Get-Content readme.md

  # Branch Specific
for:

  -
    branches:
      only:
        - dev
        
  #- ps: Write-output "dev"

  -  
    branches:
      only:
        - master

  - ps: Write-Output "Master"
 
  
    